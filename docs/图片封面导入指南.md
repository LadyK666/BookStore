# 图片封面导入指南

本指南说明如何在书店系统中导入和使用书籍封面图片。

## 方案一：使用外部图片URL（最简单，推荐）

### 使用方法
1. 在管理员界面添加或编辑书籍时，在"封面URL"字段输入完整的图片URL
2. 支持的URL格式：
   - HTTP/HTTPS URL：`https://example.com/images/book1.jpg`
   - 图床服务：`https://imgur.com/xxxxx.jpg`
   - CDN服务：`https://cdn.example.com/covers/book1.jpg`

### 示例
```
https://images-na.ssl-images-amazon.com/images/I/51xxx.jpg
https://bookcover.yuewen.com/qdbimg/349573/xxx.jpg
```

### 优点
- 无需配置，直接使用
- 不占用服务器存储空间
- 可以使用专业的图床服务

### 缺点
- 依赖外部服务，如果图片链接失效，封面会无法显示

---

## 方案二：使用本地静态资源（适合开发/测试）

### 步骤1：创建图片目录

在项目根目录创建静态资源目录：

```bash
# 在项目根目录执行
mkdir -p static/images/covers
```

或者在 Windows 上：
```
在项目根目录创建文件夹：static\images\covers
```

### 步骤2：配置后端静态资源服务

修改 `src/main/java/com/bookstore/web/WebApplication.java`，添加静态资源映射：

```java
package com.bookstore.web;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@SpringBootApplication
public class WebApplication implements WebMvcConfigurer {

    public static void main(String[] args) {
        SpringApplication.run(WebApplication.class, args);
    }

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // 配置静态资源映射
        registry.addResourceHandler("/images/**")
                .addResourceLocations("file:./static/images/");
    }
}
```

### 步骤3：放置图片文件

将封面图片文件放入 `static/images/covers/` 目录，例如：
```
static/
  images/
    covers/
      B001.jpg
      B002.jpg
      B003.png
```

### 步骤4：在管理员界面输入URL

在添加/编辑书籍时，输入相对路径：
```
/images/covers/B001.jpg
```

或者完整URL（如果后端运行在 localhost:8080）：
```
http://localhost:8080/images/covers/B001.jpg
```

---

## 方案三：实现图片上传功能（最完整，需要开发）

### 需要实现的功能

1. **后端接口**：创建图片上传接口
   - 接收 multipart/form-data 格式的文件
   - 保存文件到服务器
   - 返回文件访问URL

2. **前端组件**：添加图片上传组件
   - 文件选择器
   - 图片预览
   - 上传进度显示

### 示例代码结构

#### 后端上传接口（需要添加）

```java
@PostMapping("/api/admin/books/upload-cover")
public ResponseEntity<?> uploadCover(@RequestParam("file") MultipartFile file) {
    // 1. 验证文件类型和大小
    // 2. 生成唯一文件名
    // 3. 保存文件到 static/images/covers/
    // 4. 返回访问URL
}
```

#### 前端上传组件（需要添加）

```tsx
const [coverFile, setCoverFile] = useState<File | null>(null);
const [coverPreview, setCoverPreview] = useState<string>('');

const handleCoverChange = (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (file) {
    setCoverFile(file);
    // 预览
    const reader = new FileReader();
    reader.onloadend = () => {
      setCoverPreview(reader.result as string);
    };
    reader.readAsDataURL(file);
  }
};

const uploadCover = async () => {
  if (!coverFile) return;
  const formData = new FormData();
  formData.append('file', coverFile);
  const resp = await http.post('/admin/books/upload-cover', formData);
  // 使用返回的URL
  setNewBook({ ...newBook, coverImageUrl: resp.data.url });
};
```

---

## 推荐方案

### 开发/测试环境
- **推荐使用方案一**（外部URL）：最简单快速
- 可以使用免费的图床服务，如：
  - [Imgur](https://imgur.com/)
  - [SM.MS](https://sm.ms/)
  - [GitHub](https://github.com/)（作为图床）

### 生产环境
- **推荐使用方案三**（图片上传）：最完整，用户体验最好
- 或者使用专业的CDN服务，如：
  - 阿里云OSS
  - 腾讯云COS
  - AWS S3

---

## 快速开始示例

### 使用外部URL（立即可用）

1. 打开管理员界面
2. 添加新书籍或编辑现有书籍
3. 在"封面URL"字段输入：
   ```
   https://images-na.ssl-images-amazon.com/images/I/51xxx.jpg
   ```
4. 保存即可

### 使用本地图片（需要配置）

1. 在项目根目录创建 `static/images/covers/` 文件夹
2. 将图片文件放入该文件夹（如 `B001.jpg`）
3. 配置后端静态资源映射（见方案二）
4. 在"封面URL"字段输入：`/images/covers/B001.jpg`
5. 保存即可

---

## 注意事项

1. **图片格式**：支持 JPG、PNG、GIF、WebP 等常见格式
2. **图片大小**：建议单张图片不超过 2MB，以提升加载速度
3. **图片尺寸**：建议封面图片尺寸为 300x400 像素或按比例缩放
4. **URL格式**：确保URL完整且可访问，避免使用相对路径（除非使用本地静态资源）
5. **跨域问题**：如果使用外部URL，确保图片服务器允许跨域访问

---

## 常见问题

### Q: 图片显示不出来？
A: 检查以下几点：
- URL是否正确且可访问
- 图片服务器是否允许跨域访问
- 浏览器控制台是否有错误信息

### Q: 如何批量导入图片？
A: 目前需要手动在管理员界面逐个添加。如需批量导入，可以：
- 直接更新数据库：`UPDATE book SET cover_image_url = '/images/covers/书号.jpg' WHERE book_id = '书号';`
- 或开发批量导入功能

### Q: 图片太大影响加载速度？
A: 建议：
- 压缩图片大小（使用工具如 TinyPNG）
- 使用CDN加速
- 使用WebP格式（现代浏览器支持）

