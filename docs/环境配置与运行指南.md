# 网上书店管理系统 - 环境配置与运行指南

本文档说明如何配置开发环境并运行本项目，包括旧前端（JavaFX）和新前端（React + Ant Design）的启动方式。

---

## 一、环境要求

### 1.1 必需软件及版本

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| **JDK** | **21** | 项目使用 Java 21 编译，必须使用 JDK 21 或更高版本 |
| **Maven** | **3.6+** | 推荐使用 Maven 3.8+ 或 3.9+ |
| **Node.js** | **18.x LTS 或 20.x LTS** | 推荐使用 Node.js 18.20.0+ 或 20.10.0+ |
| **npm** | **9.x+** | 通常随 Node.js 一起安装 |
| **MySQL** | **8.0+** | 数据库服务器，推荐 MySQL 8.0.33+ |

### 1.2 版本验证命令

在开始配置前，请先验证已安装的软件版本：

```bash
# 检查 Java 版本（应显示 21 或更高）
java -version

# 检查 Maven 版本（应显示 3.6+）
mvn -version

# 检查 Node.js 版本（应显示 v18.x 或 v20.x）
node -v

# 检查 npm 版本（应显示 9.x+）
npm -v

# 检查 MySQL 版本（应显示 8.0+）
mysql --version
```

---

## 二、环境安装与配置

### 2.1 安装 JDK 21

#### Windows

1. 下载 Oracle JDK 21 或 OpenJDK 21：
   - Oracle JDK: https://www.oracle.com/java/technologies/downloads/#java21
   - OpenJDK: https://adoptium.net/zh-CN/temurin/releases/?version=21

2. 安装后配置环境变量：
   - 新建系统变量 `JAVA_HOME`，值为 JDK 安装路径（如 `C:\Program Files\Java\jdk-21`）
   - 在系统变量 `Path` 中添加 `%JAVA_HOME%\bin`

3. 验证安装：
   ```powershell
   java -version
   javac -version
   ```

#### macOS

使用 Homebrew 安装：

```bash
# 安装 OpenJDK 21
brew install openjdk@21

# 配置环境变量（添加到 ~/.zshrc 或 ~/.bash_profile）
export JAVA_HOME=$(/usr/libexec/java_home -v 21)
export PATH=$JAVA_HOME/bin:$PATH

# 重新加载配置
source ~/.zshrc  # 或 source ~/.bash_profile

# 验证安装
java -version
```

#### Linux

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-21-jdk

# CentOS/RHEL
sudo yum install java-21-openjdk-devel

# 配置环境变量（添加到 ~/.bashrc）
export JAVA_HOME=/usr/lib/jvm/java-21-openjdk
export PATH=$JAVA_HOME/bin:$PATH

# 重新加载配置
source ~/.bashrc

# 验证安装
java -version
```

### 2.2 安装 Maven

#### Windows

1. 下载 Maven：https://maven.apache.org/download.cgi（选择 `apache-maven-3.9.x-bin.zip`）

2. 解压到目录（如 `C:\Program Files\Apache\maven`）

3. 配置环境变量：
   - 新建系统变量 `MAVEN_HOME`，值为 Maven 解压路径（如 `C:\Program Files\Apache\maven`）
   - 在系统变量 `Path` 中添加 `%MAVEN_HOME%\bin`

4. 验证安装：
   ```powershell
   mvn -version
   ```

#### macOS

```bash
# 使用 Homebrew 安装
brew install maven

# 验证安装
mvn -version
```

#### Linux

```bash
# Ubuntu/Debian
sudo apt install maven

# CentOS/RHEL
sudo yum install maven

# 验证安装
mvn -version
```

### 2.3 安装 Node.js 和 npm

#### Windows / macOS / Linux

1. 下载 Node.js LTS 版本：
   - 官网：https://nodejs.org/
   - 推荐下载 Node.js 20.x LTS 版本

2. 安装后验证：
   ```bash
   node -v
   npm -v
   ```

3. （可选）配置 npm 镜像源（国内用户推荐）：
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```

### 2.4 安装 MySQL

#### Windows

1. 下载 MySQL 8.0+：https://dev.mysql.com/downloads/mysql/

2. 安装 MySQL Server，记住 root 密码

3. 启动 MySQL 服务（可通过 Windows 服务管理器或命令行）

#### macOS

```bash
# 使用 Homebrew 安装
brew install mysql@8.0

# 启动 MySQL 服务
brew services start mysql@8.0

# 设置 root 密码（首次安装后）
mysql_secure_installation
```

#### Linux

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install mysql-server

# 启动 MySQL 服务
sudo systemctl start mysql
sudo systemctl enable mysql

# 设置 root 密码
sudo mysql_secure_installation
```

---

## 三、数据库配置

### 3.1 创建数据库

1. 登录 MySQL：
   ```bash
   mysql -u root -p
   ```

2. 执行建表脚本：
   ```bash
   # 在项目根目录执行
   mysql -u root -p < docs/数据库建表脚本.sql
   ```
   
   或者手动执行：
   ```sql
   CREATE DATABASE IF NOT EXISTS bookstore
     DEFAULT CHARACTER SET utf8mb4
     DEFAULT COLLATE utf8mb4_general_ci;
   USE bookstore;
   -- 然后执行 docs/数据库建表脚本.sql 中的建表语句
   ```

### 3.2 配置数据库连接

编辑 `src/main/resources/db.properties` 文件，修改数据库连接信息：

```properties
db.url=jdbc:mysql://localhost:3306/bookstore?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
db.username=root
db.password=你的MySQL密码
db.maximumPoolSize=10
```

**重要提示**：
- 将 `db.password` 修改为你的 MySQL root 密码
- 如果 MySQL 运行在其他主机或端口，请修改 `db.url` 中的地址和端口
- 确保数据库名称与 `db.url` 中的数据库名一致（默认：`bookstore`）

---

## 四、项目构建

### 4.1 克隆或下载项目

```bash
# 如果使用 Git
git clone <项目地址>
cd BookStore

# 或直接解压项目压缩包
```

### 4.2 构建后端（Java + Maven）

在项目根目录执行：

```bash
# 清理并编译项目
mvn clean compile

# 打包项目（生成 JAR 文件）
mvn clean package

# 跳过测试打包（如果测试失败）
mvn clean package -DskipTests
```

构建成功后，会在 `target` 目录下生成 `online-bookstore-1.0.0-SNAPSHOT.jar` 文件。

### 4.3 安装前端依赖

进入前端目录并安装依赖：

```bash
cd web-frontend
npm install
```

**注意**：首次安装可能需要几分钟时间，请耐心等待。

---

## 五、运行项目

### 5.1 启动后端（Spring Boot）

#### 方式一：使用 Maven 运行（推荐用于开发）

在项目根目录执行：

```bash
# 启动 Spring Boot 后端
mvn spring-boot:run
```

#### 方式二：使用 JAR 文件运行

```bash
# 先打包
mvn clean package

# 运行 JAR 文件
java -jar target/online-bookstore-1.0.0-SNAPSHOT.jar
```

#### 方式三：在 IDE 中运行

1. 打开 `src/main/java/com/bookstore/web/WebApplication.java`
2. 右键点击 `main` 方法，选择 "Run" 或 "Debug"

**后端启动成功标志**：
- 控制台显示类似 `Started WebApplication in X.XXX seconds` 的消息
- 后端默认运行在 `http://localhost:8080`
- API 接口前缀：`http://localhost:8080/api`

### 5.2 启动新前端（React + Vite）

**前提条件**：确保后端已启动（见 5.1 节）

在项目根目录执行：

```bash
# 进入前端目录
cd web-frontend

# 启动开发服务器
npm run dev
```

**前端启动成功标志**：
- 控制台显示类似 `Local: http://localhost:5173/` 的消息
- 浏览器自动打开或手动访问 `http://localhost:5173`

**前端功能**：
- 顾客端：登录、浏览图书、购物车、下单、订单管理、地址管理、充值等
- 管理员端：订单管理、发货管理、库存管理、采购管理、客户管理、供应商管理、书目管理等

### 5.3 启动旧前端（JavaFX）

**前提条件**：确保数据库已配置并连接正常（见 三、数据库配置）

#### 方式一：使用 Maven 运行

在项目根目录执行：

```bash
# 运行 JavaFX 应用
mvn javafx:run
```

#### 方式二：在 IDE 中运行

1. 打开 `src/main/java/com/bookstore/ui/MainApp.java`
2. 右键点击 `main` 方法，选择 "Run" 或 "Debug"
3. **注意**：如果使用 IntelliJ IDEA，可能需要配置运行配置：
   - VM options: `--module-path <JavaFX SDK路径> --add-modules javafx.controls,javafx.fxml`
   - 或者使用 Maven 插件运行（推荐）

**旧前端功能**：
- 与 Web 前端功能相同，但使用 JavaFX 桌面界面
- 登录界面 → 顾客端或管理员端

---

## 六、常见问题排查

### 6.1 Java 版本不匹配

**问题**：编译时提示 "无效的目标发行版: 21"

**解决方案**：
- 检查 `java -version` 是否为 JDK 21
- 检查 IDE 中的 Java 版本设置
- 确保 `JAVA_HOME` 环境变量指向 JDK 21

### 6.2 Maven 构建失败

**问题**：`mvn clean compile` 失败

**解决方案**：
- 检查网络连接（Maven 需要下载依赖）
- 配置 Maven 镜像源（国内用户推荐）：
  - 编辑 `~/.m2/settings.xml`（如不存在则创建）
  - 添加阿里云镜像：
    ```xml
    <mirrors>
      <mirror>
        <id>aliyun</id>
        <mirrorOf>central</mirrorOf>
        <url>https://maven.aliyun.com/repository/public</url>
      </mirror>
    </mirrors>
    ```

### 6.3 数据库连接失败

**问题**：启动后端时提示 "数据库连接失败"

**解决方案**：
- 检查 MySQL 服务是否启动
- 检查 `src/main/resources/db.properties` 中的配置是否正确
- 检查数据库 `bookstore` 是否已创建
- 检查 MySQL 用户权限（确保 root 用户有权限访问 `bookstore` 数据库）

### 6.4 前端无法连接后端

**问题**：前端页面显示 "Network Error" 或无法加载数据

**解决方案**：
- 确保后端已启动（见 5.1 节）
- 检查后端是否运行在 `http://localhost:8080`
- 检查 `web-frontend/vite.config.ts` 中的代理配置是否正确
- 检查浏览器控制台是否有 CORS 错误（后端已配置 `@CrossOrigin`，通常不会有问题）

### 6.5 Node.js 版本不兼容

**问题**：`npm install` 失败或运行时出错

**解决方案**：
- 确保使用 Node.js 18.x LTS 或 20.x LTS
- 删除 `web-frontend/node_modules` 和 `web-frontend/package-lock.json`，重新执行 `npm install`
- 如果使用 Node.js 版本管理器（如 nvm），切换到正确的版本：
  ```bash
  nvm install 20
  nvm use 20
  ```

### 6.6 JavaFX 运行失败

**问题**：运行 JavaFX 应用时提示 "JavaFX runtime components are missing"

**解决方案**：
- 确保使用 JDK 21（JavaFX 已包含在 JDK 21 中）
- 如果使用较旧版本的 JDK，需要单独下载 JavaFX SDK 并配置模块路径
- 推荐使用 Maven 插件运行：`mvn javafx:run`

---

## 七、项目结构说明

```
BookStore/
├── src/                          # Java 源代码
│   ├── main/
│   │   ├── java/
│   │   │   └── com/bookstore/
│   │   │       ├── dao/          # 数据访问层
│   │   │       ├── model/        # 实体类
│   │   │       ├── service/      # 业务逻辑层
│   │   │       ├── ui/           # JavaFX 旧前端
│   │   │       ├── util/         # 工具类
│   │   │       └── web/          # Spring Boot Web API
│   │   └── resources/
│   │       └── db.properties     # 数据库配置
│   └── test/                     # 测试代码
├── web-frontend/                 # React 新前端
│   ├── src/
│   │   ├── api/                  # API 调用封装
│   │   ├── pages/                # 页面组件
│   │   └── styles/               # 样式文件
│   ├── package.json              # Node.js 依赖配置
│   └── vite.config.ts            # Vite 构建配置
├── docs/                         # 文档目录
│   ├── 数据库建表脚本.sql        # 数据库初始化脚本
│   └── 前端迁移进度.md           # 迁移进度文档
├── pom.xml                       # Maven 项目配置
└── target/                       # Maven 构建输出目录
```

---

## 八、开发建议

### 8.1 开发流程

1. **启动数据库**：确保 MySQL 服务运行
2. **启动后端**：运行 Spring Boot 应用（端口 8080）
3. **启动前端**：运行 React 开发服务器（端口 5173）
4. **访问应用**：浏览器打开 `http://localhost:5173`

### 8.2 调试技巧

- **后端调试**：在 IDE 中设置断点，使用 Debug 模式运行 `WebApplication`
- **前端调试**：使用浏览器开发者工具（F12）查看网络请求和 Console 日志
- **数据库调试**：使用 MySQL 客户端工具（如 Navicat、MySQL Workbench）查看数据

### 8.3 端口说明

| 服务 | 端口 | 说明 |
|------|------|------|
| Spring Boot 后端 | 8080 | Web API 服务 |
| React 前端 | 5173 | Vite 开发服务器 |
| MySQL | 3306 | 数据库服务（默认） |

如需修改端口：
- **后端端口**：在 `src/main/resources/application.properties` 中添加 `server.port=8080`（如不存在则创建）
- **前端端口**：修改 `web-frontend/vite.config.ts` 中的 `server.port`

---

## 九、快速启动命令总结

### 9.1 完整启动流程（新前端）

```bash
# 1. 确保 MySQL 服务运行
# Windows: 检查服务管理器
# macOS/Linux: sudo systemctl start mysql 或 brew services start mysql@8.0

# 2. 启动后端（在项目根目录）
mvn spring-boot:run

# 3. 启动前端（新开一个终端，在项目根目录）
cd web-frontend
npm run dev

# 4. 浏览器访问 http://localhost:5173
```

### 9.2 启动旧前端（JavaFX）

```bash
# 1. 确保 MySQL 服务运行
# 2. 确保数据库已创建并配置正确

# 3. 运行 JavaFX 应用（在项目根目录）
mvn javafx:run
```

---

## 十、联系与支持

如遇到问题，请检查：
1. 环境版本是否符合要求（见 一、环境要求）
2. 数据库配置是否正确（见 三、数据库配置）
3. 常见问题排查（见 六、常见问题排查）

---

**最后更新**：2025-01-XX  
**项目版本**：1.0.0-SNAPSHOT

